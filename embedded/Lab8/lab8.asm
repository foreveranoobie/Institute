#include <p16c71.inc>

TEMP equ 0x20
U1 	equ 0x21

RESET_VECTOR
	ORG 	0
	GOTO 	ENTRY_POINT
	
DELAY30US
	MOVLW 	.150 / .3
	MOVWF 	TEMP
DEC
	DECFSZ 	TEMP, F
	GOTO 	DEC
	RETURN
	
INCREMENT
	INCF 	TEMP, 1
	RETURN
	
SWAP_RB0_RB1
	MOVF PORTB
	BTFSC W, 1
	BSF PORTB, 2
	BCF PORTB, 2
	BTFSC W, 2
	BSF PORTB, 1
	BCF PORTB, 1
	RETURN
START_ADC
	MOVWF 	ADCON0
	CALL 	DELAY30US
	BSF 	ADCON0, GO_DONE
WAIT_ADC
	BTFSC	ADCON0, GO_DONE
	GOTO	WAIT_ADC
	MOVF	ADRES, W
	RETURN
	
ENTRY_POINT
	BSF 	STATUS, RP0			; BANK 1
	MOVLW 	0X00
	MOVWF 	ADCON1
	BCF 	STATUS, RP0 		; BANK 0
	
	MOVLW 	B'11001001'			; канал 1
	CALL 	START_ADC
	MOVWF 	U1
	
	MOVLW 	B'11010001' 		; канал 2
	CALL 	START_ADC
	
	SUBWF 	U1, W
	BTFSC 	STATUS, Z
	GOTO 	EQUAL
	
	BTFSS 	STATUS, C
	GOTO 	U1_BELOW
U1_ABOVE
	CALL 	INCREMENT
	GOTO 	ENTRY_POINT
U1_BELOW
	CALL 	INCREMENT
	GOTO 	ENTRY_POINT
EQUAL
	MOVLW 	0x00
	TRIS 	PORTB
	MOVLW 	0xA
	MOVWF 	PORTB
	CALL 	SWAP_RB0_RB1
	MOVLW 	0xFF
	TRIS 	PORTB
	GOTO 	ENTRY_POINT
	END